<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin:0; background:#000; color:#fff; font-family:sans-serif; overflow:hidden; }
        #market { display:none; padding:20px; height:100vh; overflow-y:auto; }
        .item { background:#111; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #00ffcc; }
        button { background:#00ffcc; color:#000; border:none; padding:10px; width:100%; border-radius:5px; font-weight:bold; }
        #intro { position:fixed; width:100%; height:100%; z-index:100; display:flex; justify-content:center; align-items:center; }
    </style>
</head>
<body>
    <div id="intro"></div>
    <div id="market">
        <h3>Balans: <span id="bal">0</span> AZN</h3>
        <div id="list"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const api = "CLOUDFLARED_LINKIN_BURA"; // Termuxdan aldığın link
        const uid = tg.initDataUnsafe.user.id;

        // 3D Planet
        const scene = new THREE.Scene();
        const cam = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('intro').appendChild(renderer.domElement);
        const globe = new THREE.Mesh(new THREE.SphereGeometry(2, 32, 32), new THREE.MeshBasicMaterial({color:0x00ffcc, wireframe:true}));
        scene.add(globe); cam.position.z = 5;
        function anim() { requestAnimationFrame(anim); globe.rotation.y += 0.01; renderer.render(scene, cam); }
        anim();

        // 4 saniyə sonra aç
        setTimeout(async () => {
            document.getElementById('intro').style.display = 'none';
            document.getElementById('market').style.display = 'block';
            
            const u = await fetch(`${api}/api/user/${uid}`).then(r => r.json());
            document.getElementById('bal').innerText = u.balance.toFixed(2);

            const srvs = await fetch(`${api}/api/services`).then(r => r.json());
            let h = '';
            srvs.slice(0, 20).forEach(s => {
                h += `<div class="item"><b>${s.name}</b><br>1k: ${s.rate} AZN<button>Sifariş</button></div>`;
            });
            document.getElementById('list').innerHTML = h;
        }, 4000);
    </script>
</body>
</html>
